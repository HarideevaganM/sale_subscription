<odoo>
    <data>
        <record id="bbis_job_card_form_inherit" model="ir.ui.view">
            <field name="name">bbis.job.card.form</field>
            <field name="model">job.card</field>
            <field name="inherit_id" ref="fms_sale.job_order_form"/>
            <field name="arch" type="xml">
                <!-- Add Vehicle Details to Terms and Conditions -->
                <field name="sale_order_id" position="after">
                    <field name="purchase_order_no"/>
                </field>

                <!-- Limit only devices in WH/Stock -->
                <field name="device_serial_number_new_id" position="attributes">
                    <attribute name="domain">[('quant_ids.location_id.name','=', 'Stock')]</attribute>
                    <attribute name="context">{'search_default_wh_stock': 1}</attribute>
                </field>

                <field name="vehicle_number" position="attributes">
                    <attribute name="context">{'default_device_id': device_id, 'default_partner_id': company_id, 'default_device_serial_number_id': device_serial_number_new_id, 'default_reseller_id': reseller_id, 'form_view_ref': 'bbis_reports.bbis_job_card_vehicle_form'}</attribute>
                </field>

                <!-- Logs -->
                <xpath expr="//sheet" position="after">
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </xpath>

                <!-- Adding new fields in Job Card. -->
                <field name="sale_type" position="after">
                    <field name="job_order_no"/>
                    <field name="job_order_date"/>
                </field>

                <!-- End: Limit only devices in WH/Stock -->

            </field>
        </record>

        <!-- Add search filter for Job Card -->
        <record model="ir.ui.view" id="bbis_job_card_search_view">
            <field name="name">bbis.job.card.search</field>
            <field name="model">job.card</field>
            <field name="inherit_id" ref="fms_sale.job_card_search_view"/>
            <field name="arch" type="xml">
                <field name="vehicle_number_old" position="after">
                    <field name="purchase_order_no" string="PO Number"/>
                    <field name="jobs_done" string="Job Done By"/>
                </field>
                <field name="engineer_id" position="before">
                    <field name="name" string="Job Card"/>
                    <field name="company_id" string="Customer"/>
                    <field name="device_serial_number_new_id" string="Device Serial"/>
                </field>
                <!--Adding grouping using Job Done By-->
                <search>
                    <group expand="1" string="Group By...">
                        <filter string="Job Done By" name="jobs_done" context="{'group_by':'jobs_done'}"/>
                    </group>
                </search>
                <!--Adding filter has subscription-->
                <filter name="engineer" position="after">
                    <filter name="has_subscription" domain="[('has_subscription', '=', True)]" string="Has Subscription"/>
                    <filter name="has_subscription" domain="[('has_subscription', '=', False)]" string="No Subscription"/>
                </filter>
            </field>
        </record>

      <!-- Add new list column for Job Done By -->
        <record model="ir.ui.view" id="bbis_job_card_tree_view_inherited">
            <field name="name">bbis.job.card.tree.view.inherited</field>
            <field name="model">job.card</field>
            <field name="inherit_id" ref="fms_sale.job_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="after">
                    <field name="job_done_by" invisible="1"/>
                    <field name="jobs_done"/>
                </xpath>
            </field>
        </record>

    </data>
</odoo>