<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="repair_models_request_inherit" model="ir.ui.view">
        <field name="name">Repair Request Inherit</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="/form/header/button[@name='action_repair_invoice_create']" position="replace">
                <button name="action_invoice_create_maintainance"  type="object" string="Create Invoice" class="oe_highlight" attrs="{'invisible': ['|',('state', '!=', 'assigned'),('invoice_method', '!=', 'after_repair')]}"/>
                <button name="action_invoice_create_maintainance_before"  type="object" string="Create Invoice" class="oe_highlight" attrs="{'invisible': ['|',('state', '!=', 'ready'),('invoice_method', '!=', 'b4repair')]}"/>
            </xpath>
            <xpath expr="/form/header/button[@name='action_repair_start']" position="replace">
                <button name="action_repair_start_delivery" attrs="{'invisible': [('state','!=','confirmed')]}" type="object" string="Start Maintenance" class="oe_highlight"/>
            </xpath>
             <xpath expr="/form/header/button[@name='action_repair_end']" position="replace">
                <button name="action_repair_end_delivery"  type="object" string="End Maintenance" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ('assigned'))]}"/>
                <button name="action_repair_end_delivery"  type="object" string="End Maintenance" class="oe_highlight" attrs="{'invisible': [('state', 'not in', ('invoiced'))]}"/>
             </xpath>

             <xpath expr="/form/sheet/group/group/field[@name='guarantee_limit']" position="replace">
                <field name="guarantee_limit" required="1"/>
                 <field name="is_invoice" invisible="1"/>
             </xpath>
            <xpath expr="/form/header/button[@name='action_validate']" position="after">
                <button name="assign_to_research" string="Assign" class="oe_highlight"  type="object" attrs="{'invisible': [('state', 'not in', ('ready','under_repair'))]}"/>
            </xpath>
            <xpath expr="/form/header/button[@name='action_validate']" position="replace">
                <button name="action_validate" states="draft" type="object" string="Confirm Maintenance" class="oe_highlight"/>
            </xpath>
            <xpath expr="/form/sheet/group/group/field[@name='lot_id']" position="after">
                <field name="picking_id"/>
                <field name="location_src_id" invisible="1"/>
                <field name="location_des_id" invisible="1"/>
                <field name="ticket_id" invisible="1"/>
            </xpath>
            <xpath expr="/form/sheet/group/group/div/field[@name='product_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
              <xpath expr="/form/sheet/group/group/label" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/notebook/page[2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
             <xpath expr="/form/sheet/notebook/page[3]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
             <xpath expr="/form/sheet/notebook/page[4]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/group/group/field[@name='location_id']" position="attributes">
               <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="attributes">
               <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/div[@class='oe_button_box']/button[@name='action_created_invoice']" position="before">
                <button name="action_delivery_view" type="object" class="oe_stat_button" icon="fa-truck" attrs="{'invisible': [('delivery_count', '=', 0)]}">
                        <field name="delivery_count" widget="statinfo" string="Delivery"/>
                </button>
            </xpath>
            <xpath expr="//page[1]" position="replace">
                <page string="Parts">
                        <field name="operations" context="{'default_product_uom_qty': product_qty}" attrs="{'readonly': [('state', 'not in', ('draft','confirmed','ready','assign','assigned'))]}" >
                            <form string="Operations">
                                <notebook>
                                    <page string="Repair Line">
                                        <group>
                                            <group>
                                                <field name="product_id"/>
                                                <field name="company_id" invisible="1"/>
                                                <field name="product_uom_category_id" invisible="1"/>
                                                <field name="name"/>
                                                <label for="product_uom_qty"/>
                                                <div class="o_row">
                                                    <field name="product_uom_qty"/>
                                                    <field name="product_uom" groups="product.group_uom"/>
                                                </div>
                                                <field name="type" invisible="1"/>
                                                <field name="price_unit"/>
                                                <field name="tax_id" widget="many2many_tags" domain="[('type_tax_use','=','sale')]"/>
                                                <field name="invoiced" invisible="1"/>
                                                <field name="price_subtotal" widget="monetary" invisible="1"/>
                                            </group>
                                            <group groups="stock.group_stock_multi_locations">
                                                <field name="location_id" invisible="1"/>
                                                <field name="location_dest_id" invisible="1"/>
                                            </group>
                                        </group>
                                    </page>
                                    <page string="History" attrs="{'invisible':[('move_id','=', False)]}">
                                        <group>
                                            <field name="move_id"/>
                                            <field name="invoice_line_id" invisible="1"/>
                                        </group>
                                    </page>
                                 </notebook>
                            </form>
                            <tree string="Operations" editable="bottom">
                                <field name="type"/>
                                <field name="company_id" invisible="1"/>
                                <field name="product_uom_category_id" invisible="1"/>
                                <field name="product_id"/>
                                <field name="name"/>
                                <field name="lot_id" domain="[('product_id', '=', product_id)]" context="{'default_product_id': product_id}" groups="stock.group_production_lot"/>
                                <field name="location_id" groups="stock.group_stock_multi_locations" invisible="1" />
                                <field name="location_dest_id" groups="stock.group_stock_multi_locations"  invisible="1"/>
                                <field name="product_uom_qty" string="Quantity"/>
                                <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                                <field name="price_unit"/>
                                <field name="tax_id" widget="many2many_tags" domain="[('type_tax_use','=','sale')]"/>
                                <field name="price_subtotal" widget="monetary"/>
                            </tree>
                        </field>
                        <group class="oe_subtotal_footer oe_right">
                            <field name="amount_untaxed" sum="Untaxed amount"/>
                            <field name="amount_tax"/>
                            <div class="oe_subtotal_footer_separator oe_inline">
                                <label for="amount_total"/>
                                <button name="button_dummy" states="draft" string="(update)" type="object" class="oe_edit_only oe_link"/>
                            </div>
                            <field name="amount_total" nolabel="1" sum="Total amount" class="oe_subtotal_footer_separator"/>
                        </group>
                    <div class="oe_clear"/>
                </page>
            </xpath>
            <xpath expr = "//page[4]" position = "after">
                <page string = "History Details" readonly="1">
                    <field name = "rep_history_line"  readonly="1">
                        <tree string = "History Details">
                            <field name = "name"/>
                            <field name = "product_id"/>
                            <field name = "product_qty"/>
                            <field name = "partner_id"/>
                            <field name = "guarantee_limit"/>
                            <field name = "amount_total"/> 
                        </tree>
                        <form>
                            <group>
                                <group>
                                    <field name = "name" />
                                    <field name = "product_id"/>
                                    <field name = "product_qty"/>
                                    <field name = "partner_id"/>
                                    <field name = "new_id" invisible = "1"/>
                                </group>
                                <group>                             
                                    <field name = "guarantee_limit"/>
                                    <field name = "amount_total"/>
                                </group>
                            </group>
                        </form>
                    </field>
                </page>
                <page string="Firmware Details">
                    <group>
                        <group>
                            <field name="product_firmware_id"/>
                            <field name="firmware_lot_id"/>
                        </group>
                        <group>
                            <field name="version_number"/>
                        </group>
                    </group>
                </page>
            </xpath>
             <!--CHANGES -->
<!--            <xpath expr="/form/sheet/group/group/field[@name='company_id']" position="attributes">
               <attribute name="invisible">1</attribute>
            </xpath>-->
        </field>
    </record>
    <record id="stock_picking_inherit_form_view_new" model="ir.ui.view">
        <field name="name">stock</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='picking_type_id']" position="after">
                <field name="repair_id"/>
                <field name="delivery_id"/>
                <field name="job_id"/>
                <field name="product_lots_id"/>
            </xpath>

             <!--CHANGES-->
            <xpath expr="/form/sheet/notebook/page[@name='extra']/group/group/field[@name='company_id']" position="attributes">
               <attribute name="invisible">1</attribute>
            </xpath>

        </field>
    </record>

      <!--CHANGES-->
    <!--<record id="stock_adjustment_view_inherit" model="ir.ui.view">
        <field name="name">stock</field>
        <field name="model">stock.inventory</field>
        <field name="inherit_id" ref="stock.view_inventory_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name='invisible'>1</attribute>
            </xpath>
        </field>
    </record>-->

    <record id="repair_delivery_form_view" model="ir.ui.view">
        <field name="name">repair</field>
        <field name="model">repair.delivery</field>
        <field name="arch" type="xml">
            <form string="Repair">
                <header>
                    <button name="confirm_delivery" class="oe_highlight" type="object" string="Confirm" states="draft"/>
                    <field name="state" widget="statusbar" />
                    <button name="create_delivery" class="oe_highlight" type="object" string="Create Delivery" states="confirmed"/>
                </header>
                <sheet>
                     <div class="oe_button_box" name="button_box">
                        <button name="action_delivery_view" type="object" class="oe_stat_button" icon="fa-truck" attrs="{'invisible': [('count_delivery', '=', 0)]}">
                            <field name="count_delivery" widget="statinfo"/>
                        </button>
                    </div>
                    <group>
                        <field name="partner_id"/>
                    </group>
                    <notebook>
                        <page string="Delivery">
                            <field name="delivery_line">
                                <tree string="Delivery" editable="bottom">
                                    <field name="delivery_id" invisible="1"/>
                                    <field name="check_type"/>
                                    <field name="repair_id" readonly="1"/>
                                    <field name="product_id" readonly="1"/>
                                    <field name="lot_id" readonly="1"/>
                                    <field name="picking_id" readonly="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="website_support_inherit_view" model="ir.ui.view">
        <field name="name">website</field>
        <field name="model">website.support.ticket</field>
        <field name="inherit_id" ref="website_support.website_support_ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="/form/header/button[@name='send_survey']" position="after">
                <field name="states" widget="statusbar" statusbar_visible="draft,done"/>
                <button name="create_job_card" type="object" string="Create Job Card" class="oe_highlight" attrs="{'invisible': ['|',('states', 'not in', ['confirmed','under_repair']),('bool_field','=',True)]}"/>
                <field name="bool_field" invisible="1"/>
                <button name="confirm_repair_order" type="object" string="Confirm Ticket" class="oe_highlight" attrs="{'invisible': [('states', '!=', 'draft')]}"/>
                <button name="action_invoice_create" type="object" string="Create Invoice" class="oe_highlight"
                        attrs="{'invisible': [('states', '!=', 'done')]}" groups="website_support.support_manager"/>
            </xpath>
            <xpath expr="/form/sheet/div[hasclass('oe_title')]" position="before">
                <div class="oe_button_box" name="button_box">
                    <button name="action_project_view" type="object" class="oe_stat_button" icon="fa-money" attrs="{'invisible': [('repair_count', '=', 0)]}">
                        <field name="repair_count" widget="statinfo"/>
                    </button>
                    <button name="action_invoice_view" type="object" class="oe_stat_button" icon="fa-money" attrs="{'invisible': [('invoice_count', '=', 0)]}">
                        <field name="invoice_count" widget="statinfo"/>
                    </button>
                    <button name="action_job_card_views" type="object" class="oe_stat_button" icon="fa-money" attrs="{'invisible': [('job_card_count', '=', 0)]}">
                        <field name="job_card_count" widget="statinfo"/>
                    </button>
                </div>
            </xpath>
            <xpath expr="/form/header/button[@name='request_approval']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="/form/header/button[@name='send_survey']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="/form/header/button[@name='request_approval']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="/form/sheet/notebook/page/group/field[@name='sla_active']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="/form/sheet/notebook/page/group/field[@name='sla_timer']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='close_time']" position="after">
				 <field name="elapsed_time"/>
				 <field name="schedule_time"/>
            </xpath>

            <xpath expr="/form/sheet/group/group/field[@name='email']" position="after">
                <field name="phone_number" widget="phone"/>
                <field name="is_invoice" invisible="1"/>
            </xpath>

            <xpath expr="/form/sheet/group/group/field[@name='state_id']" position="after">
                <field name="create_date" string="Ticket Creation" invisible="1"/>
            </xpath>

             <xpath expr="/form/sheet/notebook/page[@name='description']" position="after">
                <page string = "Vehicle Details">
                    <form>
                        <group>
                            <field name="support_id" invisible="1"/>
                            <field name="vehicle_id"  options= "{'no_create_edit': True, 'no_create':True}" />
                            <field name="device_duplicate" readonly="1" force_save="1"/>
                            <field name="serial_no" readonly="1" force_save="1"/>
                            <field name = "product_id" invisible="1"/>
                            <field name = "device_id" domain="[('product_id', '=', product_id)]" invisible="1"/>
                            <field name = "vehicle_name" readonly="1" force_save="1"/>
                            <field name = "chassis_no" readonly="1" force_save="1"/>
                            <field name = "gsm_no" readonly="1" force_save="1"/>
                            <field name = "job_id" invisible="1"/>
                            <field name = "installated_city" readonly="1" force_save="1"/>
                            <field name = "installation_city" invisible="1"/>
                            <field name="warranty_expiration" readonly="1" force_save="1"/>
                        </group>
                    </form>
                </page>
            </xpath>
        </field>
    </record>


    <!--WEBSITE-->
    <record id="website_support_ticket_inherit" model="ir.ui.view">
        <field name="name">support</field>
        <field name="model">website.support.ticket</field>
        <field name="inherit_id" ref="website_support.website_support_ticket_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="/form/sheet/group/group/field[@name='channel']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/group/group/field[@name='approval_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/group/group/field[@name='support_rating']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/form/sheet/group/group/field[@name='support_comment']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
             <xpath expr="//field[@name='close_time']" position="after">
				 <field name="job_stage"/>
			</xpath>
            <xpath expr="/form/sheet/notebook/page[3]/group" position="after">
                <group>
                    <field name="file_attachment"/>
                </group>
            </xpath>
        </field>
    </record>

    <!--CHANGES-->

    <record id="view_tree_customer_inherit" model="ir.ui.view">
        <field name="name">website</field>
        <field name="model">website.support.ticket</field>
        <field name="inherit_id" ref="website_support.website_support_ticket_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="/tree/field[@name='parent_company_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/tree/field[@name='subject']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/tree/field[@name='state_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="/tree/field[@name='state_id']" position="after">
                <field name="elapsed_time"/>
                <field name="states"/>
            </xpath>
            <xpath expr="/tree/field[@name='person_name']" position="replace">
                <field name="partner_id"/>
            </xpath>
            <xpath expr="/tree/field[@name='sla_active']" position="attributes">
				<attribute name="invisible">1</attribute>
			</xpath>
			<xpath expr="/tree/field[@name='sla_timer']" position="attributes">
				 <attribute name="invisible">1</attribute>
			</xpath>
            <xpath expr="/tree/field[@name='state_id']" position="after">
				 <field name="vehicle_id"/>
			</xpath>
<!--            <xpath expr="/tree/field[@name='vehicle_id']" position="after">-->
<!--				 <field name="job_stage"/>-->
<!--			</xpath>-->
        </field>
    </record>
    <record id="delivery_action" model="ir.actions.act_window">
                <field name="name">Delivery List</field>
                <field name="res_model">repair.delivery</field>
                <field name="view_mode">tree,form</field>
            </record>
            
     <menuitem id="delivery_process"
                      name="Delivery"
                      action ="delivery_action"
                       parent="repair.menu_repair_order"
               sequence="10"/>



    <!--REPAIR ORDER-->



    <!--ACCOUNT INVOICE-->

    <record id="account_invoice_inherit_view" model="ir.ui.view">
        <field name="name">account</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//label[@for='journal_id']" position="before">
                <label for="job_id"/>
                <div>
                    <field name="job_id"/>
                </div>
                <label for="repair_id"/>
                <div>
                    <field name="repair_id"/>
                </div>
                <field name="sale_subscription_id" invisible="1"/>
            </xpath>
             <!--CHANGES-->
            <xpath expr="/form/sheet/notebook/page[@name='other_info']/group/group/field[@name='company_id']" position="attributes">
                 <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

     <!--CHANGES-->
    <record id="account_invoice_inherit_view_tree" model="ir.ui.view">
        <field name="name">invoice</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="/tree/field[@name='company_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <!--CHANGES-->
    <!--<record id="account_invoice_inherit_view_tree_vendor" model="ir.ui.view">
        <field name="name">invoice</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.move_supplier_form"/>
        <field name="arch" type="xml">
             <xpath expr="/form/sheet/notebook/page[@name='other_info']/group/group/field[@name='company_id']" position="attributes">
                 <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>-->

    <!--CHANGES-->
    <!--<record id="project_budget_inherit" model="ir.ui.view">
        <field name="name">budget</field>
        <field name="model">crossovered.budget</field>
        <field name="inherit_id" ref="account_budget.crossovered_budget_view_form"/>
        <field name="arch" type="xml">
             <xpath expr="/form/sheet/group/group/field[@name='company_id']" position="attributes">
                 <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>-->

    <!--CHANGES-->
    <record id="project_job_cost_sheet_inherit" model="ir.ui.view">
        <field name="name">job.costing</field>
        <field name="model">job.costing</field>
        <field name="inherit_id" ref="odoo_job_costing_management.job_costing_form_view"/>
        <field name="arch" type="xml">
             <xpath expr="//field[@name='company_id']" position="attributes">
                 <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record id="repair.action_repair_order_tree" model="ir.actions.act_window">
            <field name="name">Repair Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">repair.order</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="search_view_id" ref="repair.view_repair_order_form_filter"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                No repair order found. Let's create one!
              </p><p>
                In a repair order, you can detail the components you remove,
                add or replace and record the time you spent on the different
                operations.
              </p>
            </field>
        </record>

<!--    <record id="repair.action_repair_order_tree" model="ir.actions.act_window">-->
<!--            <field name="name">Device Maintenance</field>-->
<!--            <field name="type">ir.actions.act_window</field>-->
<!--            <field name="res_model">repair.order</field>-->
<!--&lt;!&ndash;            <field name="view_type">form</field>&ndash;&gt;-->
<!--            <field name="view_mode">tree,kanban,form</field>-->
<!--            <field name="search_view_id" ref="repair.view_repair_order_form_filter"/>-->
<!--            <field name="help" type="html">-->
<!--              <p class="oe_view_nocontent_create">-->
<!--                Click to create a reparation order.-->
<!--              </p><p>-->
<!--                In a repair order, you can detail the components you remove,-->
<!--                add or replace and record the time you spent on the different-->
<!--                operations.-->
<!--              </p><p>-->
<!--                The repair order uses the warranty date on the Serial Number in-->
<!--                order to know if whether the repair should be invoiced to the-->
<!--                customer or not.-->
<!--              </p>-->
<!--            </field>-->
<!--        </record>-->

   <record model ="ir.ui.menu" id="repair.menu_repair_order">
       <field name="name">Device Maintenance</field>
   </record>

    <record id="group_repair_show" model="res.groups">
         <field name="name">Show Repair</field>
     </record>

    <record model="ir.ui.menu" id="repair.menu_repair_order">
        <field name="groups_id" eval="[(6,0,[ref('group_repair_show')])]"/>
    </record>
</odoo>
