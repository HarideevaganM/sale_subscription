<?xml version="1.0" encoding="utf-8" ?>
<odoo>
	<data>

        <record id="gfms_invoice_line_inherit" model="ir.ui.view">
            <field name="name">gfms.account.move.form.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="before">
                    <field name="sequence_ref"/>
                </xpath>
            </field>
        </record>

        <record id="report_gfms_invoice" model="ir.actions.report">
            <field name="name">Invoice Report (GFMS)</field>
            <field name="model">account.move</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">fms_invoice_report.report_gfms_tax_invoice_extended</field>
            <field name="report_file">fms_invoice_report.report_gfms_tax_invoice_extended</field>
            <field name="binding_model_id" ref="account.model_account_move"/>
            <field name="binding_type">report</field>
<!--            <field name="print_report_name">'Delivery Note - %s - %s' % (object.partner_id.name or '', object.name)</field>-->
<!--            <field name="paperformat_id" ref="gfms_reports.gfms_sales_rpt_paper_format"/>-->
        </record>

        <!--<report id="report_gfms_invoice"
            model="account.move"
            string="Invoice Report (GFMS)"
            report_type="qweb-pdf"
            file="fms_invoice_report.report_gfms_tax_invoice_extended"
            name="fms_invoice_report.report_gfms_tax_invoice_extended"
        />-->

        <template id="gfms_invoice_report">
            <t t-call="web.html_container">
                <t t-call="web.basic_layout">
                    <t t-if="doc and 'company_id' in doc">
                        <t t-set="company" t-value="doc.company_id.sudo()"/>
                    </t>
                    <t t-if="not doc or not 'company_id' in doc">
                        <t t-set="company" t-value="res_company"/>
                    </t>
                    <div class="oe_structure"/>
                    <div class="header">
                        <table style="width:100%;margin-bottom:5%;">
                            <tr>
                                <td style="width=100%">
                                  <center><img t-if="res_company.logo" t-att-src="'data:image/png;base64,%s' % to_text(res_company.logo)" class="pull-left" width="200px"/></center> 
                                </td>
                                <td class="text-right" style="font-size:18px;">
                                    <span># 24, 2nd Floor, Building # 705, Way # 5005, Ghala</span>,<br/>
                                    <span>PO Box 2006, PC 130, Muscat,Sultanate of Oman</span>,<br/>
                                    <span>Tel : +968 24222493 Email : finance.oman@fms-tech</span>,<br/>
                                    <span>Website : www.fms-tech.com</span>          
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="page">
                        <h3 class="text-center">
                            <strong> TAX INVOICE </strong>
                        </h3>
                        <div class="row mt16 mb8">
                            <div class="col-xs-4">
                                <strong>Customer:</strong><br/>
                                <span t-esc="o.partner_id.name"/><br/>
                                <span t-esc="o.partner_id.street"/>
                                <span t-esc="o.partner_id.street2"/>
                                <span t-if="o.partner_id.city" t-esc="o.partner_id.city"/>
                                <span t-if="o.partner_id.zip" t-esc="o.partner_id.zip"/><br/>
                                <span t-if="o.partner_id.state_id" t-esc="o.partner_id.state_id.name"/>
                                <span t-if="o.partner_id.country_id" t-esc="o.partner_id.country_id.name"/><br/>
                                <div class="row">
                                    <div class="col-xs-4">
                                        <div style="float: left;"><strong>Tel No</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-8"><span t-field="o.partner_id.phone"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-4">
                                        <div style="float: left;"><strong>Email</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-8"><span t-field="o.partner_id.email"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Cust VATIN</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-field="o.partner_id.vat"/></div>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Invoice No</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><div><span t-field="o.name"/></div></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Invoice Date</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-field="o.invoice_date"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>VATIN</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-field="company.vat"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Currency</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-field="o.currency_id.name"/></div>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>PO No</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-esc="o.purchase_order_no"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>PO Date</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-esc="o.purchase_order_date"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Ref No</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-esc="o.client_ref"/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-5">
                                        <div style="float: left;"><strong>Sale Order</strong></div><div style="float:right;"><strong>:</strong></div>
                                    </div>
                                    <div class="col-xs-7"><span t-esc="o.invoice_origin"/></div>
                                </div>
                            </div>
                        </div>

                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">SN</th>
                                    <th class="text-center">Item Code</th>
                                    <th class="text-center">Item Description</th>
                                    <th class="text-center">QTY</th>
                                    <th class="text-center">Per Unit Rate</th>
                                    <th class="text-center">VAT %</th>
                                    <th class="text-center">Amount</th>
                                    <th class="text-center">Output VAT</th>
                                    <th class="text-center">Total Incl VAT</th>
                                </tr>
                           </thead>
                           <tbody class="sale_tbody">
                                <t t-set="total_taxebal_amount" t-value="0.0" />
                                <t t-set="total_vat" t-value="0.0" />
                                <t t-set="total_amount" t-value="0.0" />
                                <t t-foreach="tax_invoice_lines" t-as="l">
                                    <tr>
                                        <td class="text-center"><span t-esc="l.get('sequence_ref')"/></td>
                                        <td class="text-center"><span t-esc="l.get('default_code')"/></td>
                                        <td class="text-left"><span t-esc="l.get('name')"/></td>
                                        <td class="text-center"><span t-esc="int(l.get('quantity'))"/></td>
                                        <td class="text-center"><span t-esc="l.get('price_unit')" t-options='{"widget": "float", "precision": 3}'/></td>
                                        <td class="text-center"><span t-esc="l.get('tax_name')"/></td>
                                        <td class="text-center"><span t-esc="l.get('amount_excluding_vat')" t-options='{"widget": "float", "precision": 3}'/></td>
                                        <td class="text-center"><span t-esc="l.get('output_vat')" t-options='{"widget": "float", "precision": 3}'/></td>
                                        <td class="text-center"><span t-esc="l.get('total')" t-options='{"widget": "float", "precision": 3}'/></td>
                                    </tr>
                                    <t t-set="total_taxebal_amount" t-value="total_taxebal_amount + l.get('amount_excluding_vat')"/>
                                    <t t-set="total_vat" t-value="total_vat + l.get('output_vat')"/>
                                    <t t-set="total_amount" t-value="total_amount + l.get('total')"/>
                                </t>
                            </tbody>
                        </table>

                        <div class="row mt32">
                             <div class="col-xs-8">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <strong>VAT AMOUNT in words</strong><br/>
                                        <span t-esc="o.total_amount_in_word(total_vat)"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <strong>TOTAL AMOUNT in words::</strong><br/>
                                        <span t-esc="o.total_amount_in_word(total_amount)"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-4">
                                 <div class="row">
                                    <div class="col-xs-8 text-right"><strong>Taxable Amount:</strong></div>
                                    <div class="col-xs-4 text-right"><span t-esc="total_taxebal_amount" t-options='{"widget": "float", "precision": 3}'/></div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-8 text-right"><strong>VAT:</strong></div>
                                    <div class="col-xs-4 text-right"><span t-esc="total_vat" t-options='{"widget": "float", "precision":3}'/></div>
                                </div>
                                 <div class="row">
                                    <div class="col-xs-8 text-right"><strong>Total Amount:</strong></div>
                                    <div class="col-xs-4 text-right"><span t-esc="total_amount" t-options='{"widget": "float", "precision": 3}'/></div>
                                </div>
                            </div>
                       
                        </div>
                        <div class="row mt32">
                            <div>
                                <strong>Special Notes and Instructions:</strong><br/>
                                <span t-esc="o.narration"/>
                            </div><br/>
                            <div>
                                <div>
                                    <span> For </span><span>Global Enterprises Fleet Management Systems &amp; Technologies LLC</span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <table style="width:100%;" cellpadding="1" cellspacing="0">
                                <tr style="width:100%;"><td style="text-align:center;width:100%;"><br/></td></tr>
                                <tr>
                                    <td>
                                        <img t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.authorized_signature)"  style="width:25%;height:50%;"/>
                                    </td>
                                </tr>
                                <tr style="width:100%;"><td style="text-align:center;width:100%;"><br/></td></tr>
                            </table>
                        </div>
                        <div class='text-center'><strong>Bank Account Details:</strong><br/>
                            <div class="row mt8" style="border:1px solid black;padding:3px;">
                                <div>
                                    <div class="col-xs-6">
                                        <span style="font-weight:900">Account Name : </span><span>Global Enterprises Fleet Management</span><br/>
                                        <span style="font-weight:900">Account Number : </span><span>0423-05917845-0019</span><br/>
                                        <span style="font-weight:900">Bank name : </span><span>Bank Muscat</span><br/>
                                        <span style="font-weight:900">Branch Name : </span><span>Al Nahda Tower Corporate Br</span><br/>
                                        <span style="font-weight:900">Swift Code : </span><span>BMUSOMRXXXX</span><br/>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <span style="font-weight:900">Account Name : </span> <span t-esc="company_id.acc_name"/><br/>
                                    <span style="font-weight:900">Account Number : </span> <span t-esc="company_id.account_number"/><br/>
                                    <span style="font-weight:900">Bank name : </span> <span t-esc="company_id.bank_name"/><br/>
                                    <span style="font-weight:900">Branch Name : </span> <span>Shatti Al Quram</span><br/>
                                    <span style="font-weight:900">Swift Code : </span> <span t-esc="company_id.shift_code"/><br/>
                                </div>
                            </div>
                        </div><br/><br/><br/><br/>
                        <div class="text-center">
                            <p>For any enquiries on this invoice, please email arahman@fms-tech.com or call + 968 92934369 </p>
                        </div>
                    </div>
                </t>
            </t>
        </template>

        <template id="report_gfms_tax_invoice_extended">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="fms_invoice_report.gfms_invoice_report" t-lang="o.partner_id.lang"/>
                </t>
            </t>
        </template>

	</data>
</odoo>
