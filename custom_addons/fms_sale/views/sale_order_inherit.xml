<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="sale_order_form_inherit_id" model="ir.ui.view">
        <field name="name">sale.order.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
        <xpath expr="//field[@name='payment_term_id']" position="after">
            <field name="sale_type" attrs="{'readonly':[('state','in',('done','sale'))]}"/>
            <field name="purchase_order_no" attrs="{'invisible': ['|',('sale_type', '=','cash' ),('state', '=','draft')],'readonly':[('state','in',('done','sale'))],'required':['&amp;',('sale_type', '=', 'purchase'),('state','=','submit')]}"/>
            <field name="purchase_order_date" attrs="{'invisible': ['|',('sale_type','not in', ('purchase','lease','rental')),('state', 'not in',('submit','done','sale'))],'readonly':[('state','in',('done','sale'))]}"/>
            <field name="subscription_template_id" options="{'no_create': True, 'no_create_edit':True}" attrs="{'invisible': [('state', 'not in', ('draft','submit','done','sale'))],'required':[('state', '=', 'submit')],'readonly':[('state','in',('done','sale'))]}"/>
            <field name="tree_qty" invisible='1'/>
            <field name="purchase_type" attrs="{'invisible':[('sale_type','not in', ('purchase','lease','rental'))]}"/>
            <field name="show_po" invisible='1' />
            <field name="show_project" invisible='1' />
            <field name="show_rfq" invisible='1' />
        </xpath>
        <xpath expr="//field[@name='partner_id']" position="after">
            <field name="customer_location" attrs="{'readonly':[('state','in',('done','sale'))]}"/>
            <field name="contract_lpo_test" filename="file_name" readonly="1" invisible="1"/>
            <field name="file_name" invisible="1"/>
            <field name="title"/>
            <field name="is_reseller" invisible="1"/>
<!--            <field name="new_invoice_status" invisible="1"/>-->
            <field name="division_wise_billing" invisible="1"/>
            <field name="contract_period" attrs="{'invisible':[('sale_type','not in',['lease','rental','pilot_sale'])]}"/>
            <field name="agreement_date"/>
            <field name="installed_device_count" string="Device activated" invisible="1"/>
            <field name="contract_reference" attrs="{'readonly':[('state','in',('done','sale'))]}"/>
        </xpath>
        <xpath expr="//field[@name='tag_ids']" position="before">
            <field name="validity" />
            <field name="responsible_person_ids" widget="many2many_tags"/>
        </xpath>
        <!-- buttons -->
        <xpath expr="//button[@name='action_confirm']" position="attributes">
             <attribute name="attrs">{'invisible': [('state', 'in', ['draft','cancel','sent','sale'])]}</attribute>
        </xpath>
        <button name="action_quotation_send" position="after">
             <button name="action_submit" string="Submit" class="btn-primary" type="object" attrs="{'invisible': [('state', 'in', ['submit', 'sale','cancel'])]}" groups="sales_team.group_sale_salesman"/>
         </button>
         <xpath expr="//form/header/button[@name='action_confirm'][2]" position="replace">
            <button name="action_confirm" string="Confirm Sale" class="btn-primary" type="object" invisible ="1"/>
        </xpath>
        <xpath expr="//button[@name='%(sale.action_view_sale_advance_payment_inv)d'][2]" position="replace">
            <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoices" invisible ="1"/>
        </xpath>
        <xpath expr="//button[@name='action_confirm']" position="attributes">
            <attribute name="groups">account.group_account_manager</attribute>
        </xpath>
        <xpath expr="//button[@name='%(sale.action_view_sale_advance_payment_inv)d']" position="attributes">
            <attribute name="attrs">{'invisible': ['|', ('sale_type', 'in', ('lease', 'rental')), ('state', 'not in', ('done','sale'))]}</attribute>
        </xpath>
        <button name="action_confirm" position="after">
            <button name="confirm_order" type="object" string="Create Project"
            attrs="{'invisible': ['|','&amp;', ('sale_type', '=', 'pilot'),
            ('purchase_type', '!=', 'project'),('state', 'not in', ('sale','sent'))]}"
            class="btn-primary"  groups="sales_team.group_sale_manager"/>
            <button name="subscription_create" type="object" string="Create Subscription"
            attrs="{'invisible': ['|','&amp;',('sale_type', 'not in', ('pilot','cash')),
            ('purchase_type', '!=', 'non_project'),('state', '!=', 'sale'),]}"  invisible="1"/>
            <button name ="open_job_card_wizard" type="object" string = "Assign Jobs"
            attrs="{'invisible': ['|', ('state', '!=', 'sale'), ('sale_type', '=', 'pilot')]}" groups="project.group_project_manager"/>
            <button name="get_terms" string="Get Terms and Conditions" class="btn-primary" type="object" attrs="{'invisible': [('state', '!=', 'sale')]}"/>
        </button>
        <!-- DIVISION INVOICE VIEW-->
        <xpath expr="//button[@name='action_view_invoice']" position="before">
            <button name="open_division_invoice"
                    class="oe_stat_button"
                    icon="fa-money"
                    type="object"  attrs="{'invisible':[('division_invoice_count', '=', 0)]}">
             <field name="division_invoice_count" widget="statinfo" />
            </button>
            <button name="open_jobcard_view"
                    class="oe_stat_button"
                    icon="fa-money"
                    type="object" attrs="{'invisible': [('count_card','=',0)]}">
            <field name="count_card" widget="statinfo" />
            </button>
            <button class="oe_stat_button"
            icon="fa-book"
            name="open_subscription_view"
            type="object" attrs="{'invisible':[('count_subscription','=',0)]}">
            <field name="count_subscription" widget="statinfo"/>
            </button>
            <button name="open_project_view"
                    class="oe_stat_button"
                    icon="fa-money"
                    type="object" attrs="{'invisible':[('show_project','!=',True)]}">
            <field name="project_count" widget="statinfo" />
            </button>
            <button name="open_contract"
                class="oe_stat_button"
                icon="fa-money"
                type="object" attrs="{'invisible':[('contract_count','&lt;',1)]}">
                <field name="contract_count" widget="statinfo" string="Contract"/>
            </button>
        </xpath>
        <!-- INVISIBLE ANALYTIC TAG FIELD FROM SALE ORDER LINE-->
        <xpath expr="//field[@name='order_line']/tree/field[@name='analytic_distribution']" position="after">
<!--            <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting" widget="many2many_tags" options="{'color_field': 'color'}" invisible="1"/>-->
        </xpath>
        <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="replace">
            <field name="product_id" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly': [('product_updatable', '=', False)]}" force_save="1"/>
        </xpath>
        <!-- ADDONS LINE-->
        <xpath expr="//notebook/page[1]" position="after">
            <page string="Addons Products">
                <field name="addons_accessories_line" widget="One2many_list">
                    <tree  editable="bottom" >
                        <field name="sale_order_id" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="product_id" domain="[('type','=','product')]"/>
                        <field name="name"/>
                        <field name="product_uom_qty"/>
                        <field name="product_uom"/>
                        <field name="price_unit"/>
                        <field name="price_subtotal" />
                    </tree>
                </field>
            </page>
        </xpath>
        <!--CHANGES-->
        <xpath expr="/form/sheet/notebook/page/group/group/field[@name='company_id']" position="attributes">
             <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//notebook/page[2]" position="after">
            <page string="Other Terms" width="100%">
                <group>
                    <group>
                        <field name="report_payment_terms_line" widget="One2many_list" width="16.6666666667%">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                        <field name="report_warranty_line" widget="One2many_list" width="16.6666666667%">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="contract_period_report_line" widget="One2many_list" width="16.6666666667%">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                        <field name="delivery_installation_schedule" widget="One2many_list">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="report_service_support" widget="One2many_list">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                        <field name="report_validity" widget="One2many_list">
                            <tree  editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                    </group>
                    <group>
                        <field name="other_information_line" widget="One2many_list">
                            <tree editable="bottom" >
                                <field name="name"/>
                            </tree>
                        </field>
                    </group>
                </group>
            </page>
        </xpath>

        <xpath expr="//field[@name='other_information_line']" position="after">
            <field name="sign_quotation"/>
            <label for="res_contact_id"/>
            <div class="o_row">
                <field name="res_contact_id"/>
                <field name="title_name" placeholder="Title" domain="[]" options="{&quot;no_open&quot;: True}"/>
            </div>
        </xpath>

        <xpath expr="//notebook/page[2]" position="after">
            <page string="Addons Service">
                <field name="addons_service_line" widget="One2many_list">
                    <tree  editable="bottom" >
                        <field name="sale_order_id" invisible="1"/>
                        <field name="product_id" domain="[('type','=','service')]"/>
                        <field name="name"/>
                         <field name="product_uom_qty"/>
                        <field name="product_uom"/>
                        <field name="price_unit"/>
                        <field name="price_subtotal"/>
                    </tree>
                </field>
            </page>
        </xpath>

        <field name="partner_invoice_id" position="attributes">
             <attribute name="invisible">1</attribute>
         </field>
         <field name="partner_shipping_id" position="attributes">
             <attribute name="invisible">1</attribute>
         </field>
         <!--<xpath expr="//button[@name='print_quotation'][1]" position="attributes">
            <attribute name="invisible">1</attribute>
         </xpath>
         <xpath expr="//button[@name='print_quotation'][2]" position="attributes">
            <attribute name="invisible">1</attribute>
         </xpath>-->
        </field>
    </record>

<!-- INVISIBLE ORDER UPSELL MENU FROM SALE ORDER-->
        <record id="hide_order_upsell_menu" model="res.groups">
            <field name="name">Make Order Upsell visible</field>
        </record>

        <record model="ir.ui.menu" id="sale.menu_sale_order_upselling">
            <field name="groups_id" eval="[(6,0,[ref('hide_order_upsell_menu')])]"/>
        </record>

<!-- SALE ORDER TREE VIEW INHERITED-->

    <record id="view_order_list_view_inherit" model="ir.ui.view">
        <field name="name">sale.order.tree.inherit</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="tree_qty" />
                <field name="delivered_qty" />
                <field name="installed_device_count" />
                <field name="invoiced_qty" />
                <field name="subscription_qty" />
            </xpath>
            <xpath expr="//field[@name='user_id']" position="replace">
                <field name="sale_type" />
            </xpath>
            <xpath expr="//field[@name='invoice_status']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_status']" position="after">
                <field name="account_invoice_status" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="before">
                <field name="quote_name" string="Quote Reference"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="string">Order Reference</attribute>
            </xpath>
            <!--<xpath expr="//tree/field[@name='confirmation_date']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>-->
        </field>
    </record>

<!--    <record id="sale_action_quotations_new" model="ir.actions.act_window">-->
<!--        <field name="name">Quotation</field>-->
<!--        <field name="res_model">sale.order</field>-->
<!--        <field name="view_mode">form,tree,graph</field>-->
<!--        <field name="domain">[('opportunity_id', '=', active_id), ('sale_type', 'in', ['cash', 'purchase', 'lease', 'rental'])]</field>-->
<!--        <field name="context">{'search_default_opportunity_id': active_id, 'default_opportunity_id': active_id}</field>-->
<!--&lt;!&ndash;    </record>&ndash;&gt;-->
<!--    <record id="fms_sale.sale_action_quotations_inherited" model="ir.actions.act_window">-->
<!--        <field name="name">Quotation</field>-->
<!--        <field name="res_model">sale.order</field>-->
<!--        <field name="view_mode">form,tree,graph</field>-->
<!--        <field name="domain">['&amp;', ('opportunity_id', '=', active_id), ('sale_type', 'in', ['cash', 'purchase', 'lease', 'rental'])]</field>-->
<!--        <field name="context">{'search_default_opportunity_id': active_id, 'default_opportunity_id': active_id}</field>-->
<!--    </record>-->





    <record id="view_terms_and_conditions_form" model="ir.ui.view">
            <field name="name">terms.conditions.form.view</field>
            <field name="model">terms.conditions</field>
            <field name="arch" type="xml">
                <form>
                <sheet>
                       <group>
						   <field name="name"/>
						   <field name="sale_type"/>
					   </group>
					   <group>
					   </group>
					   <group>
						   <field name="tc_paymentterms_line" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_warranty_line" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_contract_period" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_delivery_installation" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_service_support" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_validity" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
					   <group>
						   <field name="tc_other" widget="One2many_list" width="16.6666666667%">
								<tree  editable="bottom" >
									<field name="name"/>
								</tree>
							</field>
						</group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_terms_and_conditions_tree" model="ir.ui.view">
            <field name="name">terms.conditions.tree.view</field>
            <field name="model">terms.conditions</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="action_terms_and_conditions" model="ir.actions.act_window">
            <field name="name">Terms &amp; Conditions</field>
            <field name="res_model">terms.conditions</field>
<!--            <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_terms_and_conditions" name="Terms &amp; Conditions" action="action_terms_and_conditions" parent="sale.menu_sale_config"/>

        <record id="sale.action_quotations" model="ir.actions.act_window">
            <field name="domain">[('state','in', ['draft', 'submit', 'sent'])]</field>
        </record>

        <record id="sale.action_orders" model="ir.actions.act_window">
            <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel', 'submit')), ('sale_type', '!=', 'pilot_sale')]</field>
        </record>

        <!--<record id="view_quotation_tree_with_onboarding_inherit" model="ir.ui.view">
            <field name="name">sale.view_quotation_tree</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree_with_onboarding"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name='invisible'>1</attribute>
                </xpath>
                <field name="create_date" position="before">
                    <field name="quote_name"/>
                </field>
            </field>
        </record>-->

        <record id="view_sales_order_filter_inherit" model="ir.ui.view">
            <field name="name">sale.order.list.select</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name='filter_domain'>['|', '|', '|',('name', 'ilike', self), ('quote_name', 'ilike', self), ('client_order_ref', 'ilike', self), ('partner_id', 'child_of', self)]</attribute>
                    <attribute name='string'>Reference</attribute>
                </xpath>
<!--                <field name="partner_id" position="before">-->
<!--                    <field name="quote_name" />-->
<!--                </field>-->
            </field>
        </record>

</odoo>     
