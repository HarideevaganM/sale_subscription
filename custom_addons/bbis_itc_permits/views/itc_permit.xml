<?xml version="1.0" encoding="UTF-8" ?>

<odoo>
    <data>

        <!-- tree VIEWS -->
		<record id="itc_permit_tree_view" model="ir.ui.view">
			<field name="name">itc.permit.tree.view</field>
			<field name="model">itc.permit</field>
			<field name="arch" type="xml">
				<tree string="ITC Permits" decoration-success="state == 'done'" decoration-muted="state == 'draft'" decoration-info="free_permit == True">
					<!--<field name="request_number"/>-->
					<field name="name"/>
					<field name="sale_order_id"/>
					<field name="partner_id"/>
					<field name="vehicle_no"/>
					<!--<field name="chassis_no"/>-->
					<field name="device_no"/>
					<field name="permit_start_date"/>
					<field name="permit_end_date"/>
					<field name="invoice_no"/>
					<field name="free_permit" string="Free"/>
					<field name="state"/>
				</tree>
			</field>
		</record>

        <!--form VIEWS -->
		<record id="itc_permit_view_form" model="ir.ui.view">
			<field name="name">itc.permit.view.form</field>
			<field name="model">itc.permit</field>
			<field name="arch" type="xml">
				<form string="ITC Permit">
					<header>
						<button name="action_applied" type="object" states='draft' string="Applied" class="btn-primary"/>
                        <button name="action_confirm" type="object" states='applied' string="Confirm" class="btn-primary"/>
						<button name="action_cancel" type="object" states='draft,applied,done,expired' string="Cancel"/>
						<button name="action_reset" type="object" states='cancel' string="Reset to Draft"/>
						<button name="action_mark_expired" type="object" states='done' string="Mark as Expired"
								class="btn-primary"/>
                        <field name="state" widget="statusbar"  select="1"/>
                    </header>
				   <sheet>
						<group>
							<group>
								<field name="request_number" attrs="{'readonly':[('state', '=', 'done')]}"/>
								<field name="name" attrs="{'readonly':[('state', '=', 'done')]}"/>
								<field name="vehicle_no" required="1"/>
								<field name="partner_id" required="1" attrs="{'readonly':[('state', '=', 'done')]}"/>
								<field name="permit_start_date"/>
								<field name="permit_end_date"/>
								<field name="sale_order_id" context="{'sale_order_id': sale_order_id}"/>
								<field name="po_number"/>
								<field name="po_date"/>
								<field name="sale_subscription_id"/>
								<field name="subscription_end_date"/>
								<field name="free_permit"/>
							</group>
							<group>
								<field name="chassis_no"/>
								<field name="device_id"/>
								<field name="device_no"  readonly="1" force_save="1"/>
								<field name="sim_card_no"/>
								<field name="traffic_code_no"/>
								<field name="trailer_no"/>
								<field name="trailer_chassis_no"/>
								<field name="vehicle_status"/>
								<field name="invoice_no" attrs="{'readonly': 1}"/>
								<field name="remarks"/>
								<field name="cancel_reason"/>
							</group>
						</group>
					</sheet>
					<div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" />
                        <field name="activity_ids" widget="mail_activity" />
                        <field name="message_ids" widget="mail_thread" />
                    </div>
				</form>
			</field>
		</record>

		<!-- Inherit the Form view for make the Invoice Number Editable only for particular group.-->
		<record id="itc_permit_view_form_inherited" model="ir.ui.view">
			<field name="name">itc.permit.view.form.inherited</field>
			<field name="model">itc.permit</field>
			<field name="inherit_id" ref="bbis_itc_permits.itc_permit_view_form"/>
			<field name="groups_id" eval="[(6, 0, [ref('account.group_account_manager')])]"/>
			<field name="arch" type="xml">
				<xpath expr="//field[@name='invoice_no']" position="attributes">
					<attribute name="readonly">False</attribute>
				</xpath>
			</field>
		</record>

		<!--Filter and Group By-->
		<record id="itc_permit_filter" model="ir.ui.view">
			<field name="name">itc.permit.filter</field>
			<field name="model">itc.permit</field>
			<field name="arch" type="xml">
				<search>
					<field name="name"/>
					<field name="vehicle_no"/>
					<field name="sale_order_id"/>
					<field name="device_no"/>
					<field name="po_number"/>
					<field name="invoice_no"/>

					<!--Filter By-->
					<filter string="Expired Today" name="today" domain="[('permit_end_date', '=', (context_today()).strftime('%%Y-%%m-%%d'))]"/>
					<filter name="state" string="Pending" domain="[('state','=','draft')]"/>
					<filter name="state" string="Applied" domain="[('state','=','applied')]"/>
					<filter name="state" string="Expired" domain="[('state','=','expired')]"/>
					<filter name="free_permit" string="Free Permit" domain="[('free_permit','=',True)]"/>

					<!--Group By-->
					<group expand="0" string="Group By">
	                    <filter string="Client Name" name="partner_id" domain="[]" context="{'group_by':'partner_id'}"/>
	                    <filter string="Sale Order" name="sale_order_id" domain="[]" context="{'group_by':'sale_order_id'}"/>
	                    <filter string="Vehicle Number" name="vehicle_no" domain="[]" context="{'group_by':'vehicle_no'}"/>
	                    <filter string="Device Number" name="device_no" domain="[]" context="{'group_by':'device_no'}"/>
	                    <filter string="Expired" name="permit_end_date" domain="[]" context="{'group_by':'permit_end_date'}"/>
	                    <filter string="Status" name="status" domain="[]" context="{'group_by':'state'}"/>
	                    <filter string="Vehicle Status" name="vehicle_status" domain="[]" context="{'group_by':'vehicle_status'}"/>
	                    <filter string="Invoice Number" name="invoice_no" domain="[]" context="{'group_by':'invoice_no'}"/>
	                </group>
				</search>
			</field>
		</record>

		<!-- Create new action button for multiple confirm the ITC Permit-->
		<record id="multiple_itc_confirm" model="ir.actions.server">
			<field name="name">Confirm</field>
			<field name="model_id" ref="bbis_itc_permits.model_itc_permit"/>
			<field name="binding_model_id" ref="bbis_itc_permits.model_itc_permit"/>
			<field name="state">code</field>
			<field name="code">
				if records:
					records.itc_multiple_confirm()
			</field>
		</record>

        <!-- Action-->
        <record id="itc_permit_action" model="ir.actions.act_window">
            <field name="name">ITC Permit</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">itc.permit</field>
            <!--          <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="context"></field>
        </record>

    </data>
</odoo>